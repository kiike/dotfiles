#!/bin/sh
# mocp notifier for Awesome WM

mocp_status=$(mocp -i)
state=$(printf "$mocp_status"| grep "State" | cut -d ' ' -f 2)

if [[ $state == STOP ]]; then
	echo 'now_playing_widget:set_text("")' | awesome-client
	exit
fi

artist=$(printf "$mocp_status" | grep "Artist:" | cut -d ' ' -f 2-)
album=$(printf "$mocp_status"| grep "Album: "| cut -d ' ' -f 2- | sed 's/\"/\\\"/g')
title=$(printf "$mocp_status"| grep "SongTitle:" | cut -d ' ' -f 2- | sed 's/\"/\\\"/g')
totaltime=$(printf "$mocp_status"| grep "TotalTime:" | cut -d ' ' -f 2-)
formatted_output="$(printf '"%s" (%s)\nby %s\non %s\n' "$title" "$totaltime" "$artist" "$album")"

notify-send "Now playing" "$formatted_output"

if [[ -n ${title} ]] && [[ -n ${artist} ]]; then
	printf 'now_playing_widget:set_markup("<span font=\\\"Typicons 14\\\">&#57520;</span> <span color=\\\"#b16286\\\">\\\"%s\\\"</span> by <span color=\\\"#689d6a\\\">%s</span>")' \
		"$title" "$artist" \
		| awesome-client
fi
